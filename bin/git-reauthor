#!/usr/bin/env bash

export OLD_EMAIL="$1"
export CORRECT_EMAIL="$2"
export CORRECT_NAME="$3"

reauthor() {
  git filter-branch -f --env-filter '
    if [ "${GIT_AUTHOR_EMAIL}" = "${OLD_EMAIL}" ]; then
      export GIT_AUTHOR_EMAIL="${CORRECT_EMAIL}"
      export GIT_AUTHOR_NAME="${CORRECT_NAME}"
    fi

    if [ "${GIT_COMMITTER_EMAIL}" = "${OLD_EMAIL}" ]; then
      export GIT_COMMITTER_EMAIL="${CORRECT_EMAIL}"
      export GIT_COMMITTER_NAME="${CORRECT_NAME}"
    fi
  ' --tag-name-filter cat -- --branches --tags
}

reauthor